# çµ±è¨ˆåœ–å¡å’Œæ™ºæ…§æ’åºåŠŸèƒ½èªªæ˜

## æ›´æ–°æ™‚é–“ï¼š2025-11-30

## åŠŸèƒ½æ¦‚è¿°

åœ¨æ¡è³¼å„€éŒ¶æ¿åŠ å…¥**8å€‹çµ±è¨ˆåœ–å¡**å’Œ**æ™ºæ…§æ’åºåŠŸèƒ½**ï¼Œå¹«åŠ©æ¡è³¼äººå“¡å¿«é€Ÿèšç„¦åœ¨é—œéµé …ç›®ä¸Šã€‚

---

## ğŸ“Š çµ±è¨ˆåœ–å¡åŠŸèƒ½

### åœ–å¡åˆ—è¡¨ï¼ˆæŒ‰å„ªå…ˆç´šæ’åˆ—ï¼‰

#### ç¬¬ä¸€æ’ï¼šç·Šæ€¥é …ç›®

| åœ–å¡ | åœ–ç¤º | é¡è‰² | ç¯©é¸æ¢ä»¶ | èªªæ˜ |
|------|------|------|---------|------|
| **30æ—¥å…§ç¼ºæ–™** | ğŸŸ¢ | ç´…è‰²é‚Šæ¡† | shortage_within_30_days = true | éœ€å„ªå…ˆè™•ç† |
| **ç„¡äº¤æœŸé …ç›®** | ğŸ”´ | ç´…è‰²é‚Šæ¡† | æœ‰ç¼ºæ–™ä½†ç„¡äº¤æœŸ | æ€¥éœ€å¡«å¯« |
| **å·²å»¶èª¤** | ğŸš¨ | ç´…è‰²é‚Šæ¡† | äº¤æœŸå·²éä½†æœªåˆ°è²¨ | è¶…éäº¤æœŸ |
| **å³å°‡åˆ°æœŸ** | ğŸŸ¡ | æ©™è‰²é‚Šæ¡† | 7æ—¥å…§åˆ°è²¨ | 7æ—¥å…§åˆ°è²¨ |

#### ç¬¬äºŒæ’ï¼šä¸€èˆ¬çµ±è¨ˆ

| åœ–å¡ | åœ–ç¤º | é¡è‰² | ç¯©é¸æ¢ä»¶ | èªªæ˜ |
|------|------|------|---------|------|
| **ç¸½ç¼ºæ–™é …ç›®** | ğŸ“¦ | è—è‰²é‚Šæ¡† | current_shortage > 0 æˆ– projected_shortage > 0 | æ‰€æœ‰ç¼ºæ–™ |
| **æˆ‘çš„é …ç›®** | ğŸ‘¤ | è—è‰²é‚Šæ¡† | ç•¶å‰ä½¿ç”¨è€…è² è²¬ | æˆ‘è² è²¬çš„ï¼ˆæš«æœªå¯¦ä½œï¼‰ |
| **æœ¬é€±éœ€æ±‚** | ğŸ“… | è—è‰²é‚Šæ¡† | éœ€æ±‚æ—¥æœŸåœ¨æœ¬é€± | æœ¬é€±è¦åˆ°è²¨ |
| **åº«å­˜å……è¶³** | âšª | ç°è‰²é‚Šæ¡† | ç„¡ç¼ºæ–™ | ç„¡éœ€è™•ç† |

### äº’å‹•åŠŸèƒ½

#### é»æ“Šç¯©é¸
1. é»æ“Šåœ–å¡ â†’ è‡ªå‹•ç¯©é¸å°æ‡‰é …ç›®
2. åœ–å¡é«˜äº®é¡¯ç¤ºï¼ˆè—è‰²èƒŒæ™¯ + âœ“ æ¨™è¨˜ï¼‰
3. é¡¯ç¤ºç¯©é¸å¾½ç« ã€Œç›®å‰ç¯©é¸: XXXã€
4. å†æ¬¡é»æ“Š â†’ å–æ¶ˆç¯©é¸

#### è¦–è¦ºæ•ˆæœ
- **æ­£å¸¸ç‹€æ…‹**ï¼šç™½è‰²èƒŒæ™¯ï¼Œé‚Šæ¡†é¡è‰²è¡¨ç¤ºå„ªå…ˆç´š
- **æ‡¸åœç‹€æ…‹**ï¼šå¡ç‰‡ä¸Šç§»ï¼Œé™°å½±åŠ æ·±
- **å•Ÿå‹•ç‹€æ…‹**ï¼šè—è‰²èƒŒæ™¯ï¼Œå³ä¸Šè§’âœ“æ¨™è¨˜

---

## ğŸ“… æœ€æ—©éœ€æ±‚æ—¥æ¬„ä½

### æ–°å¢è¡¨æ ¼æ¬„ä½

```
ç‰©æ–™ç·¨è™Ÿ | ç‰©æ–™èªªæ˜ | æ¡è³¼äººå“¡ | æœ€æ—©éœ€æ±‚æ—¥ | ç¸½éœ€æ±‚ | åº«å­˜ | ...
```

### é¡è‰²æ¨™ç¤º

| ç‹€æ…‹ | é¡è‰² | æ¢ä»¶ | èªªæ˜ |
|------|------|------|------|
| ğŸ”´ ç´…è‰²åŠ ç²— | #d32f2f | å·²éæœŸ | diffDays < 0 |
| ğŸŸ¡ æ©™è‰²åŠ ç²— | #ff9800 | 7æ—¥å…§ | 0 â‰¤ diffDays â‰¤ 7 |
| ğŸŸ¢ ç¶ è‰²åŠ ç²— | #4caf50 | 30æ—¥å…§ | 8 â‰¤ diffDays â‰¤ 30 |
| âš« é»‘è‰² | é è¨­ | 30æ—¥å¾Œ | diffDays > 30 |

### æ‡¸åœæç¤º
- å·²éæœŸï¼štitle="å·²éæœŸ"
- 7æ—¥å…§ï¼štitle="7æ—¥å…§éœ€æ±‚"
- 30æ—¥å…§ï¼štitle="30æ—¥å…§éœ€æ±‚"

---

## ğŸ¯ æ™ºæ…§æ’åºé‚è¼¯

### æ’åºè¦å‰‡ï¼ˆæŒ‰å„ªå…ˆé †åºï¼‰

```javascript
1. 30æ—¥å…§ç¼ºæ–™ â†’ æ°¸é æ’æœ€å‰ï¼ˆæ·ºç¶ è‰²èƒŒæ™¯ï¼‰
2. æœ€æ—©éœ€æ±‚æ—¥æœŸ â†’ è¶Šæ—©è¶Šå‰é¢
3. ç¼ºæ–™æ•¸é‡ â†’ è¶Šå¤šè¶Šå‰é¢ï¼ˆç›¸åŒéœ€æ±‚æ—¥æ™‚ï¼‰
4. é è¨ˆç¼ºæ–™æ•¸é‡ â†’ è¶Šå¤šè¶Šå‰é¢
```

### ç¯„ä¾‹æ’åºçµæœ

```
ç‰©æ–™ç·¨è™Ÿ    æœ€æ—©éœ€æ±‚æ—¥   ç¼ºæ–™  æ’åºèªªæ˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸŸ¢ 10001   2025-12-05   50   â† 30æ—¥å…§ + æœ€æ—©
ğŸŸ¢ 10002   2025-12-08   30   â† 30æ—¥å…§ + æ¬¡æ—©
ğŸŸ¢ 10003   2025-12-08   80   â† åŒæ—¥æœŸï¼Œç¼ºæ–™å¤š
   10004   2025-12-15   60   â† é30æ—¥å…§ï¼Œéœ€æ±‚æ—©
   10005   2025-12-20   40   â† é30æ—¥å…§ï¼Œéœ€æ±‚è¼ƒæ™š
```

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œ

### å¾Œç«¯ API

#### 1. `/api/demand_details/all`
```python
@api_bp.route('/demand_details/all')
@cache_required
def get_all_demand_details():
    """å–å¾—æ‰€æœ‰ç‰©æ–™çš„éœ€æ±‚è©³æƒ…"""
    # åˆä½µä¸»å„€è¡¨æ¿å’Œæˆå“å„€è¡¨æ¿
    combined_map = {**demand_details_map, **finished_demand_details_map}
    return jsonify(combined_map)
```

#### 2. `/api/delivery/all`
```python
@api_bp.route('/delivery/all')
def get_all_deliveries():
    """å–å¾—æ‰€æœ‰äº¤æœŸè³‡æ–™"""
    # è¿”å›æœ€æ–°çš„äº¤æœŸè¨˜éŒ„
    schedules = {material_id: history[-1] for material_id, history in ...}
    return jsonify({"schedules": schedules, "total": len(schedules)})
```

### å‰ç«¯å‡½æ•¸

#### ä¸»è¦å‡½æ•¸

| å‡½æ•¸å | åŠŸèƒ½ | æª”æ¡ˆ |
|--------|------|------|
| `enhanceMaterialsData()` | å¢å¼·ç‰©æ–™è³‡æ–™ï¼ˆåŠ å…¥æœ€æ—©éœ€æ±‚æ—¥æœŸï¼‰ | stats-helper.js |
| `setupStatsCardEvents()` | è¨­å®šåœ–å¡é»æ“Šäº‹ä»¶ | stats-helper.js |
| `applyStatFilter()` | å¥—ç”¨çµ±è¨ˆç¯©é¸ | stats-helper.js |
| `clearStatFilter()` | æ¸…é™¤çµ±è¨ˆç¯©é¸ | stats-helper.js |
| `calculateStats()` | è¨ˆç®—çµ±è¨ˆæ•¸æ“š | stats-helper.js |
| `updateStatsCards()` | æ›´æ–°åœ–å¡æ•¸å­— | stats-helper.js |
| `filterMaterialsByStats()` | æŒ‰åœ–å¡ç¯©é¸ç‰©æ–™ | stats-helper.js |
| `sortMaterialsByPriority()` | æ™ºæ…§æ’åº | stats-helper.js |
| `loadProcurementDashboard()` | è¼‰å…¥å„€éŒ¶æ¿ï¼ˆä¿®æ”¹ï¼‰ | main.js |
| `renderMaterialsTable()` | æ¸²æŸ“è¡¨æ ¼ï¼ˆä¿®æ”¹ï¼‰ | main.js |

#### è³‡æ–™æµç¨‹

```
1. é é¢è¼‰å…¥
   â†“
2. loadProcurementDashboard()
   â”œâ”€ è¼‰å…¥ç‰©æ–™è³‡æ–™
   â”œâ”€ è¼‰å…¥äº¤æœŸè³‡æ–™
   â”œâ”€ è¼‰å…¥éœ€æ±‚è©³æƒ…
   â†“
3. enhanceMaterialsData()
   â”œâ”€ è¨ˆç®—æ¯å€‹ç‰©æ–™çš„æœ€æ—©éœ€æ±‚æ—¥æœŸ
   â”œâ”€ åŠ å…¥äº¤æœŸè³‡è¨Š
   â†“
4. updateStatsCards()
   â”œâ”€ è¨ˆç®—å„é …çµ±è¨ˆæ•¸å­—
   â”œâ”€ æ›´æ–°åœ–å¡é¡¯ç¤º
   â†“
5. renderMaterialsTable()
   â”œâ”€ å¥—ç”¨ç¯©é¸ï¼ˆæœå°‹ã€æ¡è³¼äººå“¡ã€çµ±è¨ˆåœ–å¡ï¼‰
   â”œâ”€ æ™ºæ…§æ’åºï¼ˆ30æ—¥å…§å„ªå…ˆ â†’ éœ€æ±‚æ—¥æœŸï¼‰
   â”œâ”€ åˆ†é é¡¯ç¤º
   â†“
6. ä½¿ç”¨è€…é»æ“Šåœ–å¡
   â†“
7. applyStatFilter()
   â”œâ”€ æ›´æ–°åœ–å¡ç‹€æ…‹
   â”œâ”€ é¡¯ç¤ºç¯©é¸å¾½ç« 
   â”œâ”€ é‡æ–°æ¸²æŸ“è¡¨æ ¼
```

---

## ğŸ“ CSS æ¨£å¼

### åœ–å¡æ¨£å¼

```css
/* ç¶²æ ¼ä½ˆå±€ */
.stats-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 1em;
}

/* åŸºæœ¬æ¨£å¼ */
.stat-card {
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    padding: 1em;
    cursor: pointer;
    transition: all 0.3s ease;
}

/* æ‡¸åœæ•ˆæœ */
.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* å•Ÿå‹•ç‹€æ…‹ */
.stat-card.active {
    border-color: var(--pico-primary);
    border-width: 3px;
    background: #e3f2fd;
    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
}

/* å„ªå…ˆç´šé¡è‰² */
.stat-card.priority-high {
    border-left: 4px solid #f44336;
}

.stat-card.priority-medium {
    border-left: 4px solid #ff9800;
}

.stat-card.priority-normal {
    border-left: 4px solid #2196f3;
}

.stat-card.priority-low {
    border-left: 4px solid #9e9e9e;
}
```

---

## ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆ

### æ‰‹æ©Ÿç‰ˆèª¿æ•´

```css
@media (max-width: 768px) {
    .stats-cards-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .stat-card {
        padding: 0.8em;
    }
    
    .stat-icon {
        font-size: 1.5em;
    }
    
    .stat-number {
        font-size: 1.5em;
    }
}
```

- è‡ªå‹•èª¿æ•´ç‚º 2 æ¬„é¡¯ç¤º
- æ¸›å°‘å…§é‚Šè·
- ç¸®å°åœ–ç¤ºå’Œæ•¸å­—å¤§å°

---

## ğŸ§ª æ¸¬è©¦å»ºè­°

### æ¸¬è©¦æ¡ˆä¾‹

#### 1. çµ±è¨ˆåœ–å¡
- âœ… æ•¸å­—æ­£ç¢ºè¨ˆç®—
- âœ… é»æ“Šç¯©é¸æ­£å¸¸
- âœ… åœ–å¡é«˜äº®é¡¯ç¤º
- âœ… ç¯©é¸å¾½ç« é¡¯ç¤º
- âœ… å†æ¬¡é»æ“Šå–æ¶ˆç¯©é¸

#### 2. æœ€æ—©éœ€æ±‚æ—¥
- âœ… æ—¥æœŸæ­£ç¢ºé¡¯ç¤º
- âœ… é¡è‰²æ¨™ç¤ºæ­£ç¢ºï¼ˆç´…/æ©™/ç¶ ï¼‰
- âœ… æ‡¸åœæç¤ºæ­£ç¢º
- âœ… ç„¡éœ€æ±‚æ—¥é¡¯ç¤º"-"

#### 3. æ™ºæ…§æ’åº
- âœ… 30æ—¥å…§ç¼ºæ–™æ’æœ€å‰
- âœ… æŒ‰éœ€æ±‚æ—¥æœŸæ’åº
- âœ… ç›¸åŒæ—¥æœŸæŒ‰ç¼ºæ–™æ•¸é‡æ’åº
- âœ… æ·ºç¶ è‰²èƒŒæ™¯ä¿æŒ

#### 4. ç¶œåˆæ¸¬è©¦
- âœ… åœ–å¡ç¯©é¸ + æœå°‹
- âœ… åœ–å¡ç¯©é¸ + æ¡è³¼äººå“¡ç¯©é¸
- âœ… åˆ‡æ›å„€éŒ¶æ¿ï¼ˆä¸»/æˆå“ï¼‰
- âœ… åˆ†é æ­£å¸¸é‹ä½œ

---

## âš¡ æ•ˆèƒ½è€ƒé‡

### è³‡æ–™è™•ç†

- **ä¸€æ¬¡è¼‰å…¥**ï¼šåŒæ™‚è¼‰å…¥æ‰€æœ‰éœ€è¦çš„è³‡æ–™
- **å‰ç«¯è¨ˆç®—**ï¼šæœ€æ—©éœ€æ±‚æ—¥æœŸåœ¨å‰ç«¯è¨ˆç®—
- **å¿«å–ä½¿ç”¨**ï¼šçµ±è¨ˆæ•¸æ“šå¿«å–åœ¨å…¨åŸŸè®Šæ•¸

### å„ªåŒ–å»ºè­°

1. **æ‰¹æ¬¡è™•ç†**ï¼šå¤§é‡è³‡æ–™æ™‚åˆ†æ‰¹è¨ˆç®—
2. **å»¶é²è¼‰å…¥**ï¼šçµ±è¨ˆæ•¸æ“šå¯ä»¥å»¶é²è¨ˆç®—
3. **Web Worker**ï¼šè¤‡é›œè¨ˆç®—ç§»åˆ°èƒŒæ™¯åŸ·è¡Œ

---

## ğŸ”® æœªä¾†æ”¹é€²

### çŸ­æœŸï¼ˆ1-2é€±ï¼‰

1. **æˆ‘çš„é …ç›®åŠŸèƒ½**
   - å¯¦ä½œä½¿ç”¨è€…ç™»å…¥
   - æ ¹æ“šç™»å…¥ä½¿ç”¨è€…ç¯©é¸

2. **äº¤æœŸæé†’**
   - å³å°‡åˆ°æœŸé …ç›®ç™¼é€é€šçŸ¥
   - å»¶èª¤é …ç›®æ¨™è¨˜

### ä¸­æœŸï¼ˆ1å€‹æœˆï¼‰

1. **è¶¨å‹¢åœ–è¡¨**
   - ç¼ºæ–™è¶¨å‹¢åœ–
   - äº¤æœŸé”æˆç‡åœ–è¡¨

2. **æ‰¹æ¬¡æ“ä½œ**
   - æ‰¹æ¬¡å¡«å¯«äº¤æœŸ
   - æ‰¹æ¬¡åŒ¯å‡º

### é•·æœŸï¼ˆ3å€‹æœˆï¼‰

1. **é æ¸¬åˆ†æ**
   - AIé æ¸¬ç¼ºæ–™é¢¨éšª
   - å»ºè­°æ¡è³¼é‡

2. **è¡Œå‹•è£ç½®App**
   - æ¨æ’­é€šçŸ¥
   - é›¢ç·šæŸ¥è©¢

---

## ğŸ“ ç›¸é—œæª”æ¡ˆ

### å‰ç«¯
- `app/views/procurement.html` - HTMLçµæ§‹
- `app/static/js/main.js` - ä¸»è¦é‚è¼¯
- `app/static/js/stats-helper.js` - çµ±è¨ˆå’Œæ’åºå‡½æ•¸
- `app/static/css/style.css` - æ¨£å¼

### å¾Œç«¯
- `app/controllers/api_controller.py` - APIç«¯é»
- `app/services/data_service.py` - è³‡æ–™è™•ç†

### æ–‡ä»¶
- `30æ—¥å…§ç¼ºæ–™æ¨™ç¤ºåŠŸèƒ½èªªæ˜.md` - 30æ—¥ç¼ºæ–™åŠŸèƒ½
- `çµ±è¨ˆåœ–å¡å’Œæ™ºæ…§æ’åºåŠŸèƒ½èªªæ˜.md` - æœ¬æ–‡ä»¶

---

## âœ… é©—è­‰æ¸…å–®

- âœ… HTML çµæ§‹æ­£ç¢º
- âœ… CSS æ¨£å¼å®Œæ•´
- âœ… JavaScript èªæ³•æª¢æŸ¥é€šé
- âœ… Python èªæ³•æª¢æŸ¥é€šé
- âœ… API ç«¯é»å·²å»ºç«‹
- â³ ç­‰å¾…é‡æ–°å•Ÿå‹•æ¸¬è©¦

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

1. **åœæ­¢ç¾æœ‰æœå‹™**
   ```powershell
   Get-Process -Name python | Where-Object {$_.Path -like "*order*"} | Stop-Process -Force
   ```

2. **é‡æ–°å•Ÿå‹•**
   ```powershell
   cd C:\app\order
   .\start_order_server.ps1
   ```

3. **æ¸¬è©¦**
   - è¨ªå• http://192.168.6.119:5002/procurement
   - æª¢æŸ¥çµ±è¨ˆåœ–å¡é¡¯ç¤º
   - æ¸¬è©¦é»æ“Šç¯©é¸
   - ç¢ºèªæ’åºæ­£ç¢º

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### æ¡è³¼äººå“¡å·¥ä½œæµç¨‹

```
æ¯æ—¥æª¢æŸ¥ï¼š
1. é–‹å•Ÿæ¡è³¼å„€éŒ¶æ¿
2. æŸ¥çœ‹ã€Œ30æ—¥å…§ç¼ºæ–™ã€åœ–å¡æ•¸å­—
3. é»æ“Šã€Œ30æ—¥å…§ç¼ºæ–™ã€ç¯©é¸
4. æŒ‰ã€Œæœ€æ—©éœ€æ±‚æ—¥ã€é †åºè™•ç†
5. é»æ“Šç‰©æ–™ç·¨è™ŸæŸ¥çœ‹è©³æƒ…
6. å¡«å¯«äº¤æœŸç¶­è­·è¡¨å–®
```

### å¿«æ·æ“ä½œ

- **Ctrl + F**ï¼šç€è¦½å™¨æœå°‹ç‰©æ–™
- **é»æ“Šè¡¨é ­**ï¼šæ‰‹å‹•æ’åº
- **é»æ“Šåœ–å¡**ï¼šå¿«é€Ÿç¯©é¸
- **é»æ“Šç‰©æ–™**ï¼šæŸ¥çœ‹è©³æƒ…
- **é»æ“Šæ¡è³¼äººå“¡**ï¼šç·¨è¼¯æˆ–æŸ¥çœ‹åƒè€ƒæ¸…å–®

---

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚é‡å•é¡Œè«‹æª¢æŸ¥ï¼š
1. ç€è¦½å™¨æ§åˆ¶å°æ˜¯å¦æœ‰éŒ¯èª¤
2. å¾Œç«¯æ—¥èªŒ app_errors.log
3. ç¶²è·¯è«‹æ±‚æ˜¯å¦æˆåŠŸï¼ˆF12 Networkï¼‰
4. è³‡æ–™æ˜¯å¦æ­£ç¢ºè¼‰å…¥
